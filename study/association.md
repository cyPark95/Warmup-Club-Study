# 연관관계(Association)

두 개 이상의 테이블 또는 객체 간의 연결을 의미한다.

#### 1:1 관계

- `@OnnToOne`
    - 한 테이블의 레코드가 다른 테이블의 단 하나의 레코드와만 관련
    - `@JoinColumn`
        - 연관관계의 주인이 활용할 수 있는 어노테이션
        - 필드의 이름이나 null 여부, 유일성 여부, 업데이트 여부 등을 지정

#### N:1 관계

- `@ManyToOne`
    - 한 테이블의 한 레코드가 다른 테이블의 여러 레코드와 관련
    - N쪽(Many)에 @ManyToOne을 설정하고 1쪽(One)에 @OneToMany를 설정하여 양방향 매핑을 구성
    - 양방향이 아닌 단방향으로 사용할 수 있다.
    - 연관관계의 주인은 `@ManyToOne`을 사용한 쪽으로 설정

#### N:M 관계

- `@ManyToMany`
    - 한 테이블의 여러 레코드가 다른 테이블의 여러 레코드와 관련
    - 구조가 복잡하고, 테이블이 직관적으로 매핑되지 않아 사용하지 않는 것을 추천
    - 중간 엔티티(Join Table)를 두고 `@OneToMany`, `@ManyToOne`으로 해결하는 방법을 권장

## 연관관계의 주인

- JPA에서는 연관관계의 주인을 정해 FK를 관리한다.
- 연관관계의 주인이 외래 키를 관리(등록, 수정)하며, 주인이 아닌 쪽은 읽기만 가능하다.
- 연관관계의 주인이 아닌 쪽에 `mappedBy` 옵션을 통해 소유자를 지정한다.

### 효과

- 객체가 연결되는 기준이 된다.
- 상대 테이블을 참조하고 있으면 연관관계의 주인
- 연관관계의 주인이 아니면 `mappedBy` 옵션을 사용
- 연관관계의 주인의 `setter`가 사용되어야만 테이블 연결

### 주의사항

- 양방향 연관관계를 갖고 있다면 양쪽 모두 한 번에 설정해주는게 좋다.
- 연관관계의 주인을 올바르게 설정하지 않으면 데이터 무결성 문제가 발생할 수 있다.
- 데이터 직렬화할 때, 엔티티간의 순환 참조가 발생할 수 있다.

### cascade 옵션

- 한 객체가 저장되거나 삭제될 때, 그 변경이 폭포처럼 흘러 **연결되어 있는 객체도 함께 저장되거나 삭제**되는 기능
- 데이터가 삭제될 때 연결된 데이터까지 한 번에 삭제 된다.

#### orphanRemoval 옵션

- orphan(고아): 관계가 끊어진 데이터
- removal: 제거
- 객체간의 관계가 끊어진 데이터를 자동으로 제거하는 옵션
